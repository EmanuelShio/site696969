<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carregando...</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #f5f5f5;
            font-family: Arial, sans-serif;
        }
        .loader {
            text-align: center;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="loader">
        <div class="spinner"></div>
        <p>Carregando...</p>
    </div>

    <script>
        // ==========================================
        // CONFIGURAÇÕES DO CLOAKER
        // ==========================================
        const CONFIG = {
            // Ative (true) ou desative (false) o cloaker
            ATIVO: true,
            
            // URL para redirecionamento (visitantes não autorizados)
            URL_REDIRECIONAMENTO: 'https://www.tudogostoso.com.br/receita/309779-bolo-de-chocolate-simples.html',
            
            // URL da página principal (produto)
            URL_PRODUTO: 'https://alfabetizacao-alegre.vercel.app',
            
            // Parâmetro necessário na URL
            PARAMETRO_OBRIGATORIO: 'utm_source',
            VALOR_PARAMETRO: 'KW-'  // Aceita qualquer valor que comece com KW-
        };

        // ==========================================
        // FUNÇÕES DE DETECÇÃO
        // ==========================================

        // Detecta se é um bot óbvio
        function ehBot() {
            const userAgent = navigator.userAgent.toLowerCase();
            const bots = [
                'bot', 'crawler', 'spider', 'scraper', 'curl', 'wget',
                'facebookexternalhit', 'whatsapp', 'telegrambot', 
                'slackbot', 'twitterbot', 'pinterest', 'linkedinbot',
                'googlebot', 'bingbot', 'baiduspider', 'yandex'
            ];
            
            return bots.some(bot => userAgent.includes(bot));
        }

        // Detecta se é smartphone (não tablet ou desktop)
        function ehSmartphone() {
            const userAgent = navigator.userAgent.toLowerCase();
            const width = window.innerWidth || screen.width;
            
            // Bloqueia tablets (normalmente > 768px)
            if (width > 768) return false;
            
            // Detecta mobile, mas exclui tablets
            const isMobile = /android|webos|iphone|ipod|blackberry|iemobile|opera mini/i.test(userAgent);
            const isTablet = /ipad|android(?!.*mobile)|tablet/i.test(userAgent);
            
            return isMobile && !isTablet;
        }

        // Verifica se tem o parâmetro correto na URL
        function temParametroCorreto() {
            const urlParams = new URLSearchParams(window.location.search);
            const valor = urlParams.get(CONFIG.PARAMETRO_OBRIGATORIO);
            // Verifica se o valor COMEÇA com o padrão configurado
            return valor && valor.startsWith(CONFIG.VALOR_PARAMETRO);
        }

        // Detecta comportamento suspeito (verificações extras)
        function comportamentoSuspeito() {
            // Verifica se tem propriedades típicas de headless browsers
            if (navigator.webdriver) return true;
            
            // Verifica se plugins estão vazios (comum em bots)
            if (navigator.plugins.length === 0) return true;
            
            // Verifica se a linguagem está definida
            if (!navigator.language) return true;
            
            return false;
        }

        // ==========================================
        // LÓGICA PRINCIPAL DO CLOAKER
        // ==========================================
        
        function executarCloaker() {
            // Se o cloaker estiver DESATIVADO, permite acesso direto
            if (!CONFIG.ATIVO) {
                window.location.href = CONFIG.URL_PRODUTO;
                return;
            }

            // Registra tentativa de acesso (para debug - remova em produção)
            console.log('Verificando acesso...');

            // BLOQUEIO 1: Bots óbvios
            if (ehBot()) {
                console.log('❌ Bot detectado');
                window.location.replace(CONFIG.URL_REDIRECIONAMENTO);
                return;
            }

            // BLOQUEIO 2: Comportamento suspeito
            if (comportamentoSuspeito()) {
                console.log('❌ Comportamento suspeito');
                window.location.replace(CONFIG.URL_REDIRECIONAMENTO);
                return;
            }

            // BLOQUEIO 3: Não é smartphone (tablet ou desktop)
            if (!ehSmartphone()) {
                console.log('❌ Não é smartphone');
                window.location.replace(CONFIG.URL_REDIRECIONAMENTO);
                return;
            }

            // BLOQUEIO 4: Não tem parâmetro correto na URL
            if (!temParametroCorreto()) {
                console.log('❌ Parâmetro incorreto ou ausente');
                window.location.replace(CONFIG.URL_REDIRECIONAMENTO);
                return;
            }

            // ✅ PASSOU EM TODAS AS VERIFICAÇÕES
            console.log('✅ Acesso autorizado!');
            window.location.href = CONFIG.URL_PRODUTO;
        }

        // Executa imediatamente
        executarCloaker();
    </script>
</body>
</html>